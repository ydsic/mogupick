name: Discord Notification on Push

on:
  push:
    branches: [prototype]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Set developer name
        id: dev-name
        run: |
          if [ "${{ github.actor }}" = "ydsic" ]; then
            echo "name=ì´ì˜ˆë„" >> $GITHUB_OUTPUT
          elif [ "${{ github.actor }}" = "eillen-yang" ]; then
            echo "name=ì–‘ì•„ë¦„" >> $GITHUB_OUTPUT
          else
            echo "name=${{ github.actor }}" >> $GITHUB_OUTPUT
          fi

          timestamp=$(TZ='Asia/Seoul' date -d "${{ github.event.head_commit.timestamp }}" +"%mì›” %dì¼ %H:%M")
          echo "formatted-time=${timestamp} (KST)" >> $GITHUB_OUTPUT

          # commit messageì—ì„œ ì²« ì¤„(íƒ€ì´í‹€)ë§Œ ì¶”ì¶œí•˜ì—¬ outputìœ¼ë¡œ ì„¤ì •
          commit_title=$(echo "${{ github.event.head_commit.message }}" | head -n1)
          echo "commit-title=${commit_title}" >> $GITHUB_OUTPUT

      - name: Send Discord notification
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            ## ğŸ‰ ì‚¬ì´íŠ¸ê°€ ì—…ë°ì´íŠ¸ ë˜ì—ˆì–´ìš”! PM, PDë¶„ë“¤ì€ í…ŒìŠ¤íŠ¸ í•´ë³´ì‹œê³  ë§ì”€í•´ì£¼ì„¸ìš”!

            **ğŸ‘¤ Deployer:** `${{ steps.dev-name.outputs.name }}`
            **â° Time:** `${{ steps.dev-name.outputs.formatted-time }}`

            **ğŸ’­ Commit Message(Title):**
            ```
            ${{ steps.dev-name.outputs.commit-title }}
            ```
            **ğŸ”— GitHub Link:** <${{ github.event.head_commit.url }}>

            **ğŸ”— Prototype Link:** https://mogupick-prototype.vercel.app

            **ğŸ”— Update Link:** https://www.notion.so/goormkdx/Prototype-255c0ff4ce31805facf6c8fbfe7ddc12
